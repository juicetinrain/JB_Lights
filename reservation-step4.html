<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Reserve — Step 4: Payment & Review | JB Lights & Sound</title>
  <link rel="stylesheet" href="style.css">
  <script src="reservation.js" defer></script>
</head>
<body>
  <nav class="jb-navbar">
    <div class="container">
      <a class="brand" href="index.html"><img src="jb-logo.png" alt=""><span>JB Lights & Sound</span></a>
    </div>
  </nav>

  <main class="jb-page">
    <div class="jb-progress jb-card">
      <div style="flex:1">
        <div class="step"><div class="bar" style="width:100%"></div></div>
        <div class="labels"><span>Package</span><span>Confirm</span></div>
      </div>
    </div>

    <section class="jb-card">
      <div class="jb-title">Payment & Review</div>
      <div class="jb-sub">Choose payment method (downpayment only for GCash). Review details below before confirming.</div>

      <div style="display:grid;gap:16px">

        <!-- payment -->
        <div>
          <div class="payment-box">
            <label class="form-label fw-semibold">Payment Method</label>

            <div class="payment-method" data-pay="cash" onclick="choosePayment('cash', this)">
              <input type="radio" name="payment" value="cash">
              <div>
                <div style="font-weight:700">Cash on Delivery</div>
                <div class="hint">Pay the full amount after the event. No downpayment required.</div>
              </div>
            </div>

            <div class="payment-method" data-pay="gcash" onclick="choosePayment('gcash', this)">
              <input type="radio" name="payment" value="gcash">
              <div>
                <div style="font-weight:700">GCash (Downpayment)</div>
                <div class="hint">A downpayment (suggested 30%) is required. Balance after the event.</div>
              </div>
            </div>

            <div id="gcashDetails" style="display:none;margin-top:12px">
              <div class="gcash-details">
                <div class="gcash-qr">GCASH QR (replace image)</div>
                <div>
                  <div style="font-weight:700">GCash Account</div>
                  <div class="hint">Name: JB Lights & Sound</div>
                  <div class="hint">No.: 0965-639-6053</div>
                  <div style="margin-top:8px;font-size:0.98rem">Downpayment will be shown in the review below.</div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- review -->
        <div class="jb-card">
          <div style="font-weight:700;margin-bottom:10px">Review your reservation</div>
          <div id="reviewList">
            <div class="review-row"><div>Package</div><div id="reviewPackage">—</div></div>
            <div class="review-row"><div>Date & time</div><div id="reviewDate">—</div></div>
            <div class="review-row"><div>Event Address</div><div id="reviewAddress">—</div></div>
            <div class="review-row"><div>Contact</div><div id="reviewContact">—</div></div>
            <div class="review-row"><div>Payment</div><div id="reviewPayment">—</div></div>
            <div class="review-row"><div>Downpayment (if GCash)</div><div id="reviewDown">—</div></div>
          </div>
        </div>

        <div class="jb-foot-fixed">
          <div class="hint">After confirming, staff will contact you to finalize availability & logistics.</div>
          <div style="display:flex;gap:12px">
            <a class="btn btn-secondary-jb btn-large" href="reservation-step3.html">Back</a>
            <button id="confirm" class="btn btn-primary-jb btn-large">Confirm Reservation</button>
          </div>
        </div>

      </div>
    </section>
  </main>

  <script>
    // choose payment selection & update review
    function choosePayment(value, el){
      document.querySelectorAll('.payment-method').forEach(m=>{
        m.classList.remove('selected');
        m.querySelector('input').checked = false;
      });
      el.classList.add('selected');
      el.querySelector('input').checked = true;

      const data = window.jbRes.read() || {};
      data.payment = value;
      window.jbRes.write(data);

      document.getElementById('gcashDetails').style.display = (value === 'gcash') ? 'block' : 'none';
      updateReview();
    }

    function updateReview(){
      const data = window.jbRes.read() || {};
      document.getElementById('reviewPackage').textContent = data.packageLabel || '—';
      document.getElementById('reviewDate').textContent = (data.date ? window.jbFormatDate(data.date) : '—') + (data.time ? ' • ' + data.time : '');
      document.getElementById('reviewAddress').textContent = data.address || '—';
      document.getElementById('reviewContact').textContent = (data.name || '-') + ' • ' + (data.phone || '-');
      document.getElementById('reviewPayment').textContent = (data.payment === 'gcash') ? 'GCash (Downpayment)' : (data.payment === 'cash') ? 'Cash on Delivery' : '—';

      // downpayment calc (simple 30% of package price extracted from label if numeric present)
      let down = '—';
      if(data.payment === 'gcash' && data.packageLabel){
        // attempt extract number
        const m = data.packageLabel.match(/₱([\d,]+)/);
        if(m){
          const num = parseInt(m[1].replace(/,/g,''),10);
          down = '₱' + Math.round(num * 0.30).toLocaleString();
        } else {
          down = 'Contact for downpayment';
        }
      }
      document.getElementById('reviewDown').textContent = down;
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      updateReview();
      const data = window.jbRes.read() || {};
      if(data.payment){
        const el = document.querySelector(`.payment-method[data-pay="${data.payment}"]`);
        if(el) { el.classList.add('selected'); el.querySelector('input').checked=true; }
        if(data.payment==='gcash') document.getElementById('gcashDetails').style.display='block';
      }
    });

    document.getElementById('confirm').addEventListener('click', ()=>{
      const data = window.jbRes.read() || {};
      if(!data.package || !data.date || !data.address || !data.name || !data.phone || !data.payment){
        alert('Please complete all steps before confirming.');
        return;
      }
      // simulate submission (in real app: send to server)
      const payload = Object.assign({}, data, {submittedAt: new Date().toISOString()});
      console.log('Reservation payload (simulate send):', payload);

      alert('Reservation submitted! Our staff will contact you soon to confirm details.');
      // clear local data
      window.jbRes.clear();
      // go to a thank you / confirmation page (or homepage)
      window.location.href = 'reservation-confirmation.html';
    });
  </script>
</body>
</html>